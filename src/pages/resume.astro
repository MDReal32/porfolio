---
import Layout from "../layouts/Layout.astro";
import { portfolio } from "../data/portfolio";
import { formatYearMonth } from "../utils/formatDate";
import PrintButton from "../components/PrintButton.astro";

const { basics, summary, experience, projects, skills, education, languages } = portfolio;
---

<Layout>
  <main class="resume-doc mx-auto max-w-3xl space-y-10 px-6 py-12 leading-relaxed">
    <!-- Header -->
    <header class="space-y-4">
      <!-- Top row: identity + print -->
      <div class="flex items-start justify-between gap-6">
        <div class="space-y-1">
          <h1 class="text-base-content text-3xl font-bold tracking-tight">
            {basics.fullName}
          </h1>

          <p class="text-base-content/80 text-base">
            {basics.title} · {basics.location}
          </p>
        </div>

        <!-- Print button -->
        <PrintButton />
      </div>

      <!-- Contact row -->
      <div class="text-base-content/70 flex flex-wrap gap-x-4 gap-y-2 text-sm">
        <a href={`mailto:${basics.email}`} class="hover:text-base-content transition">
          {basics.email}
        </a>

        {
          basics.links?.linkedin && (
            <a href={basics.links.linkedin} target="_blank" rel="noreferrer" class="hover:text-base-content transition">
              LinkedIn
            </a>
          )
        }

        {
          basics.links?.github && (
            <a href={basics.links.github} target="_blank" rel="noreferrer" class="hover:text-base-content transition">
              GitHub
            </a>
          )
        }
      </div>

      <!-- Divider -->
      <div class="border-base-300/60 border-t pt-6"></div>
    </header>

    <!-- Summary -->
    {
      summary && (
        <section class="space-y-2">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Summary</h2>
          {summary.lines.map(line => (
            <p>{line}</p>
          ))}
        </section>
      )
    }

    <!-- Experience -->
    {
      experience && (
        <section class="space-y-4">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Experience</h2>

          {experience.map(role => (
            <div class="space-y-2">
              <div class="flex items-baseline justify-between gap-4">
                <p class="text-base-content font-medium">
                  {role.role} — {role.company}
                </p>

                <p class="text-base-content/60 text-sm whitespace-nowrap">
                  {formatYearMonth(role.start)} — {role.end === "Present" ? "Present" : formatYearMonth(role.end)}
                </p>
              </div>

              {role.location && <p class="text-base-content/60 text-sm">{role.location}</p>}

              {role.highlights?.length ? (
                <ul class="text-base-content/70 mt-2 space-y-1 text-sm leading-6">
                  {role.highlights.map(h => (
                    <li class="flex gap-2">
                      <span class="bg-base-content/40 mt-1.5 h-1 w-1 rounded-full" />
                      <span>{h}</span>
                    </li>
                  ))}
                </ul>
              ) : null}
            </div>
          ))}
        </section>
      )
    }

    <!-- Projects -->
    {
      projects && (
        <section class="space-y-4">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Projects</h2>

          <div class="space-y-3">
            {projects.map(p => (
              <div class="space-y-1">
                <p class="text-base-content font-medium">{p.name}</p>

                <p class="text-base-content/70 text-sm">{p.tagline}</p>

                {p.stack?.length ? (
                  <p class="text-base-content/60 text-sm">
                    <span class="text-base-content/50 text-xs tracking-wide uppercase">Stack</span>
                    <span class="ml-2">{p.stack.join(" · ")}</span>
                  </p>
                ) : null}
              </div>
            ))}
          </div>
        </section>
      )
    }

    <!-- Skills -->
    {
      skills && (
        <section class="space-y-4">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Skills</h2>

          <div class="text-base-content/75 space-y-2 text-sm">
            {skills.primary?.length ? (
              <p>
                <span class="text-base-content font-medium">Primary:</span> {skills.primary.join(" · ")}
              </p>
            ) : null}

            {skills.secondary?.length ? (
              <p>
                <span class="text-base-content font-medium">Secondary:</span> {skills.secondary.join(" · ")}
              </p>
            ) : null}

            {skills.tooling?.length ? (
              <p>
                <span class="text-base-content font-medium">Tooling:</span> {skills.tooling.join(" · ")}
              </p>
            ) : null}
          </div>
        </section>
      )
    }

    <!-- Education -->
    {
      education && (
        <section class="space-y-4">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Education</h2>

          <div class="space-y-3">
            {education.map(e => (
              <div class="space-y-1">
                <p class="text-base-content font-medium">{e.program}</p>
                <p class="text-base-content/70 text-sm">
                  {e.school}
                  {e.location ? ` · ${e.location}` : ""}
                </p>
                <p class="text-base-content/60 text-sm">
                  {formatYearMonth(e.start)} — {formatYearMonth(e.end)}
                </p>
              </div>
            ))}
          </div>
        </section>
      )
    }

    <!-- Languages -->
    {
      languages && (
        <section class="space-y-4">
          <h2 class="text-base-content/50 text-xs tracking-widest uppercase">Languages</h2>

          <p class="text-base-content/75 text-sm">{languages.map(l => `${l.name} (${l.level})`).join(" · ")}</p>
        </section>
      )
    }
  </main>
</Layout>
